__d(function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default;Object.defineProperty(e,"__esModule",{value:!0}),e.updateCache=void 0;var n=t(r(d[1])),o=r(d[2]);const u=(t,n)=>{if(n&&t?.paymentDataRequest){const u=JSON.parse(t.paymentDataRequest),s=JSON.stringify((0,o.convertToStableObjectOrder)({...u,bill_info:{...u?.bill_info,bill_item_product_id:n}}));return{...t,paymentDataRequest:s}}return t};e.updateCache=({proxy:t,stayCheckout:o,variables:s})=>{const c=o?.sections?.metadata?.confirmationCode||void 0,p=u(s?.input?.quickPayData,c),l={input:{...s.input,confirmationCode:c,quickPayData:p}};t.unsafe__writeQuery({query:n.default,variables:l,data:{presentation:{__typename:'RootPresentationContainer',stayCheckout:o}}})}},"3a7831",["ba7a76","54d6bb","f82df7"]);
__d(function(g,r,i,a,m,e,d){"use strict";var t=r(d[0]).default,o=r(d[1]).default;function s(){const t=r(d[2]);return s=function(){return t},t}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,e.mutateSearchWithParams=$;var n=r(d[3]),u=r(d[4]),c=r(d[5]),f=r(d[6]),y=o(r(d[7]));function C(){const t=r(d[8]);return C=function(){return t},t}var l=t(r(d[9])),h=t(r(d[10])),p=r(d[11]),_=t(r(d[12])),v=t(r(d[13])),k=t(r(d[14])),b=r(d[15]),O=r(d[16]),P=r(d[17]),I=r(d[18]);function $({confirmationCode:t,orderId:o,params:n,staysData:c}){const y=v.default.current().curr,{numberOfGuests:C,guestCurrency:l}=n;l&&l!==y&&(0,u.airdogCount)('checkout_web_create_route.currency_mismatch',1,{url_currency:l,user_currency:y});const h={...n,code:t,orderId:o,guestCurrency:l||y||void 0};if(!(void 0!==C||!c)){const{numberOfAdults:t,numberOfChildren:o,numberOfGuests:n,numberOfInfants:u,numberOfPets:y}=c||{},C={numberOfAdults:t??void 0,numberOfChildren:o??void 0,numberOfGuests:n??void 0,numberOfInfants:u??void 0,numberOfPets:y??void 0,...h};return(0,f.warn)('[Checkout][Stays] create route recovery flow triggered',{extra:{updatedParams:h,staysData:c}}),`?${(0,s().stringify)(C)}`}return`?${(0,s().stringify)(h)}`}const x=(0,l.default)({universalPageName:4003,includeHistoryUpdate:()=>!1})(({location:t,queryRef:o})=>{const f=(0,C().useNiobeClient)(),{search:l}=t,v=(0,n.useMemo)(()=>(0,c.coerceStaysCheckoutParams)((0,h.default)(l)),[l]),{productId:x}=v,D=(0,y.default)()===y.FORM_FACTOR.COMPACT,{data:M,error:R}=(0,C().usePreloadedQuery)({query:k.default,queryRef:o});return x||(0,O.reportStaysCheckoutInputError)(v,'StaysCheckoutCreateRoute_mutation'),(0,n.useEffect)(()=>{const t=M?.presentation?.stayCheckout?.sections?.metadata?.clientLoggingContext?.staysData?.checkoutProductVersion||null;(0,u.airdogCount)('checkout.stays.route.first_render',1,{has_data:!!M,route:'stays_create_route',is_compact:D,checkout_prefetch_on_hover_v2:!D||'compact',product_version:t})},[]),(0,n.useEffect)(()=>{if((R||M?.presentation?.stayCheckout?.sections?.metadata?.clientLoggingContext?.errorCode||M?.presentation?.stayCheckout?.sections?.metadata?.errorData)&&(0,u.airdogCount)('stays_checkout.create_route.error',1,{errorCode:M?.presentation?.stayCheckout?.sections?.metadata?.clientLoggingContext?.errorCode,niobeError:R?.message,hasRedirect:!!M?.presentation?.stayCheckout?.sections?.metadata?.errorData?.redirectUrl}),M?.presentation?.stayCheckout){const{stayCheckout:t}=M.presentation,o=t.sections?.metadata?.orderId||void 0,s=$({confirmationCode:t.sections?.metadata?.confirmationCode||void 0,orderId:o,params:v,staysData:t.sections?.stateMutation||void 0}),n=(0,P.getCheckoutPrepareMutationVariables)({params:{...v,orderId:o}});(0,b.updateCache)({proxy:f,stayCheckout:t,variables:n}),(0,p.replaceToHistory)(`/book/stays/${x}${s}`)}else{const t=`?${(0,s().stringify)(v)}`;(0,p.replaceToHistory)(`/book/stays/${x}${t}`)}},[M,R,x,v,f,D]),(0,I.jsx)(_.default,{})});e.default=x},"8ffd6d",["ba7a76","45f788","e950a3","07aa1f","3e4681","068d42","f2f40f","e0b071","068abc","3a6fa9","a7c4ef","4ee5a9","f27cf8","06a99e","54d6bb","3a7831","ec8c71","6c477c","b8c07d"]);
//# sourceMappingURL=https://sourcemaps.d.musta.ch/airbnb/static/packages/web/common/frontend/checkout-route-stays/routes/StaysCheckoutRoute/StaysCheckoutCreateRoute.6f1b292fc3.js.map